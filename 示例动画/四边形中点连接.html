<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>四边形中点连接</title>
    <script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/p5.js/1.4.1/p5.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        .container {
            display: flex;
            gap: 20px;
        }
        .canvas-container {
            border: 2px solid #333;
            background-color: white;
        }
        .controls {
            width: 200px;
            height: 600px;
            background-color: #e3f2fd;
            border: 2px solid #2196f3;
            padding: 15px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        .control-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #1976d2;
        }
        button {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            background-color: #2196f3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #1976d2;
        }
        .info {
            background-color: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #4caf50;
        }
        .error-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 800px;
            height: 200px;
            background-color: #ffebee;
            border: 2px solid #f44336;
            padding: 15px;
            box-sizing: border-box;
            overflow-y: auto;
            display: none;
        }
        .error-title {
            color: #d32f2f;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="canvas-container">
            <div id="canvas"></div>
        </div>
        <div class="controls">
            <h3 style="color: #1976d2; margin-top: 0;">四边形中点连接</h3>
            
            <div class="control-group">
                <label>操作说明：</label>
                <div class="info">
                    <p>• 拖拽红色点调整四边形</p>
                    <p>• 绿色点为各边中点</p>
                    <p>• 蓝色线段连接中点</p>
                </div>
            </div>

            <div class="control-group">
                <label>显示选项：</label>
                <button onclick="toggleLabels()">切换标签显示</button>
                <button onclick="toggleMidpoints()">切换中点显示</button>
                <button onclick="toggleConnections()">切换中点连接</button>
            </div>

            <div class="control-group">
                <label>重置：</label>
                <button onclick="resetQuadrilateral()">重置四边形</button>
            </div>

            <div class="control-group">
                <label>数学信息：</label>
                <div class="info">
                    <p><strong>四边形面积：</strong><span id="quadArea">0</span></p>
                    <p><strong>中点四边形面积：</strong><span id="midArea">0</span></p>
                    <p><strong>面积比：</strong><span id="areaRatio">0</span></p>
                </div>
            </div>

            <div class="control-group">
                <label>定理说明：</label>
                <div class="info">
                    <p>任意四边形的中点四边形是平行四边形，其面积是原四边形面积的一半。</p>
                </div>
            </div>
        </div>
    </div>

    <div class="error-container" id="errorContainer">
        <div class="error-title">错误信息：</div>
        <div id="errorContent"></div>
    </div>

    <script>
        let vertices = [];
        let midpoints = [];
        let showLabels = true;
        let showMidpoints = true;
        let showConnections = true;
        let selectedVertex = -1;
        let isDragging = false;

        function setup() {
            try {
                let canvas = createCanvas(600, 600);
                canvas.parent('canvas');
                
                // 初始化四边形顶点（逆时针顺序）
                vertices = [
                    {x: 150, y: 150},  // A
                    {x: 450, y: 200},  // B
                    {x: 400, y: 400},  // C
                    {x: 200, y: 350}   // D
                ];
                
                calculateMidpoints();
                updateInfo();
            } catch (error) {
                showError(error);
            }
        }

        function draw() {
            try {
                background(255);
                
                // 绘制四边形
                drawQuadrilateral();
                
                // 绘制中点
                if (showMidpoints) {
                    drawMidpoints();
                }
                
                // 绘制中点连接
                if (showConnections) {
                    drawMidpointConnections();
                }
                
                // 绘制标签
                if (showLabels) {
                    drawLabels();
                }
                
                // 处理拖拽
                handleDragging();
                
            } catch (error) {
                showError(error);
            }
        }



        function drawQuadrilateral() {
            // 绘制四边形边
            stroke(0);
            strokeWeight(2);
            noFill();
            
            for (let i = 0; i < 4; i++) {
                let current = vertices[i];
                let next = vertices[(i + 1) % 4];
                line(current.x, current.y, next.x, next.y);
            }
            
            // 绘制顶点
            fill(255, 0, 0);
            stroke(0);
            strokeWeight(2);
            
            for (let i = 0; i < vertices.length; i++) {
                let v = vertices[i];
                ellipse(v.x, v.y, 12, 12);
            }
        }

        function drawMidpoints() {
            fill(0, 255, 0);
            stroke(0);
            strokeWeight(2);
            
            for (let i = 0; i < midpoints.length; i++) {
                let mp = midpoints[i];
                ellipse(mp.x, mp.y, 8, 8);
            }
        }

        function drawMidpointConnections() {
            stroke(0, 0, 255);
            strokeWeight(2);
            noFill();
            
            for (let i = 0; i < midpoints.length; i++) {
                let current = midpoints[i];
                let next = midpoints[(i + 1) % 4];
                line(current.x, current.y, next.x, next.y);
            }
        }

        function drawLabels() {
            fill(0);
            textSize(16);
            textAlign(CENTER, CENTER);
            
            // 顶点标签
            let labels = ['A', 'B', 'C', 'D'];
            for (let i = 0; i < vertices.length; i++) {
                let v = vertices[i];
                text(labels[i], v.x, v.y - 20);
            }
            
            // 中点标签
            let midLabels = ['E', 'F', 'G', 'H'];
            for (let i = 0; i < midpoints.length; i++) {
                let mp = midpoints[i];
                text(midLabels[i], mp.x, mp.y - 15);
            }
        }

        function calculateMidpoints() {
            midpoints = [];
            for (let i = 0; i < 4; i++) {
                let current = vertices[i];
                let next = vertices[(i + 1) % 4];
                midpoints.push({
                    x: (current.x + next.x) / 2,
                    y: (current.y + next.y) / 2
                });
            }
        }

        function mousePressed() {
            try {
                for (let i = 0; i < vertices.length; i++) {
                    let v = vertices[i];
                    let d = dist(mouseX, mouseY, v.x, v.y);
                    if (d < 10) {
                        selectedVertex = i;
                        isDragging = true;
                        break;
                    }
                }
            } catch (error) {
                showError(error);
            }
        }

        function mouseDragged() {
            try {
                if (isDragging && selectedVertex >= 0) {
                    vertices[selectedVertex].x = constrain(mouseX, 20, 580);
                    vertices[selectedVertex].y = constrain(mouseY, 20, 580);
                    calculateMidpoints();
                    updateInfo();
                }
            } catch (error) {
                showError(error);
            }
        }

        function mouseReleased() {
            isDragging = false;
            selectedVertex = -1;
        }

        function handleDragging() {
            if (isDragging) {
                cursor(HAND);
            } else {
                cursor(ARROW);
            }
        }

        function calculateArea(points) {
            let area = 0;
            for (let i = 0; i < points.length; i++) {
                let current = points[i];
                let next = points[(i + 1) % points.length];
                area += current.x * next.y - next.x * current.y;
            }
            return Math.abs(area) / 2;
        }

        function updateInfo() {
            try {
                let quadArea = calculateArea(vertices);
                let midArea = calculateArea(midpoints);
                let ratio = quadArea > 0 ? midArea / quadArea : 0;
                
                document.getElementById('quadArea').textContent = quadArea.toFixed(2);
                document.getElementById('midArea').textContent = midArea.toFixed(2);
                document.getElementById('areaRatio').textContent = ratio.toFixed(2);
            } catch (error) {
                showError(error);
            }
        }

        function toggleLabels() {
            showLabels = !showLabels;
        }

        function toggleMidpoints() {
            showMidpoints = !showMidpoints;
        }

        function toggleConnections() {
            showConnections = !showConnections;
        }

        function resetQuadrilateral() {
            try {
                vertices = [
                    {x: 150, y: 150},
                    {x: 450, y: 200},
                    {x: 400, y: 400},
                    {x: 200, y: 350}
                ];
                calculateMidpoints();
                updateInfo();
            } catch (error) {
                showError(error);
            }
        }

        function showError(error) {
            console.error(error);
            const errorContainer = document.getElementById('errorContainer');
            const errorContent = document.getElementById('errorContent');
            
            errorContent.innerHTML = `
                <strong>错误位置：</strong>${error.stack || '未知位置'}<br>
                <strong>错误信息：</strong>${error.message}<br>
                <strong>错误类型：</strong>${error.name}<br>
                <strong>时间：</strong>${new Date().toLocaleString()}
            `;
            
            errorContainer.style.display = 'block';
            
            // 5秒后自动隐藏
            setTimeout(() => {
                errorContainer.style.display = 'none';
            }, 5000);
        }

        // 全局函数供按钮调用
        window.toggleLabels = toggleLabels;
        window.toggleMidpoints = toggleMidpoints;
        window.toggleConnections = toggleConnections;
        window.resetQuadrilateral = resetQuadrilateral;
    </script>
</body>
</html> 